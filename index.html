
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ICSTIC — The Interact Club of St. Thomas' Catholic International College</title>
<meta name="description" content="ICSTIC: members/admin tools, calendar, quarterly Best Interactor, albums, completed projects, private chat."/>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
  html{scroll-behavior:smooth}
  .aurora{background:
    radial-gradient(1200px 600px at 10% 10%, rgba(16,185,129,.35), transparent 60%),
    radial-gradient(1000px 500px at 90% 20%, rgba(59,130,246,.30), transparent 60%),
    radial-gradient(1000px 700px at 30% 90%, rgba(234,179,8,.25), transparent 60%),
    linear-gradient(180deg,#0b1220 0%,#0e1324 40%,#0f172a 100%)}
  .glass{background:rgba(255,255,255,.06);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.12)}
  .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:.75rem;padding:.5rem 1rem;font-weight:500;box-shadow:0 1px 2px rgba(0,0,0,.2);transition:all .2s}
  .btn-primary{background:#10b981;color:#fff}.btn-primary:hover{background:#059669}
  .btn-rose{background:#f43f5e;color:#fff}.btn-rose:hover{background:#e11d48}
  .btn-ghost{background:rgba(255,255,255,.1);color:#fff}.btn-ghost:hover{background:rgba(255,255,255,.2)}
  dialog::backdrop{background:rgba(0,0,0,.6)}
</style>
</head>
<body class="aurora min-h-screen text-white">
<header class="sticky top-0 z-50 glass">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex items-center justify-between py-3">
      <div class="flex items-center gap-3">
        <img id="clubLogo" alt="ICSTIC logo" class="h-10 w-10 rounded-full ring-2 ring-white/20 object-cover"/>
        <div>
          <h1 class="text-xl font-bold">ICSTIC</h1>
          <p class="text-xs text-white/70">The Interact Club of St. Thomas' Catholic International College</p>
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#home" class="hover:text-emerald-300">Home</a>
        <a href="#member" class="hover:text-emerald-300">Members</a>
        <a href="#chat" class="hover:text-emerald-300">Chat</a>
        <a href="#calendar" class="hover:text-emerald-300">Calendar</a>
        <a href="#best" class="hover:text-emerald-300">Best Interactor</a>
        <a href="#photos" class="hover:text-emerald-300">Family Photos</a>
        <a href="#projects" class="hover:text-emerald-300">Completed Projects</a>
        <a href="#about" class="hover:text-emerald-300">About</a>
        <a href="#admin" class="hover:text-emerald-300">Admin</a>
      </nav>
      <button class="md:hidden btn btn-ghost" id="openNav"><i data-lucide="menu" class="w-5 h-5"></i></button>
    </div>
    <div id="mobileNav" class="hidden border-t border-white/10 pb-3 md:hidden">
      <div class="grid grid-cols-2 gap-2 pt-3 text-sm">
        <a href="#home" class="btn btn-ghost">Home</a>
        <a href="#member" class="btn btn-ghost">Members</a>
        <a href="#chat" class="btn btn-ghost">Chat</a>
        <a href="#calendar" class="btn btn-ghost">Calendar</a>
        <a href="#best" class="btn btn-ghost">Best Interactor</a>
        <a href="#photos" class="btn btn-ghost">Family Photos</a>
        <a href="#projects" class="btn btn-ghost">Projects</a>
        <a href="#about" class="btn btn-ghost col-span-2">About</a>
        <a href="#admin" class="btn btn-ghost col-span-2">Admin</a>
      </div>
    </div>
  </div>
</header>

<!-- HOME -->
<section id="home" class="max-w-7xl mx-auto px-4 py-10">
  <div class="grid md:grid-cols-2 gap-8 items-center">
    <div class="space-y-5">
      <h2 class="text-3xl md:text-4xl font-extrabold">Welcome to ICSTIC</h2>
      <p class="text-white/80 leading-relaxed">
        Welcome to the official page of our Interact club. Here you will find everything you need to know about being a member of our Interact Club and the role you play in this Family.
      </p>
      <div class="flex gap-3">
        <a href="#member" class="btn btn-primary">Member Login</a>
        <a href="#admin" class="btn btn-rose">Admin Area</a>
      </div>
    </div>
    <div class="glass rounded-3xl p-6">
      <div class="flex items-center gap-4">
        <img id="heroLogo" class="h-24 w-24 rounded-2xl ring-2 ring-white/10 object-cover" alt="ICSTIC logo"/>
        <div>
          <h3 class="text-2xl font-semibold">ICSTIC</h3>
          <div class="text-sm text-white/70">The Interact Club of St. Thomas' Catholic International College</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- MEMBERS -->
<section id="member" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Members Area</h2>
  <div id="memberGate" class="glass rounded-2xl p-6">
    <div class="grid md:grid-cols-2 gap-6 items-end">
      <div>
        <label class="block text-sm mb-1">Your Name</label>
        <input id="memberName" class="w-full rounded-xl bg-white/10 border border-white/20 p-3 outline-none" placeholder="Your name"/>
      </div>
      <div>
        <label class="block text-sm mb-1">Member Password</label>
        <input id="memberPass" type="password" class="w-full rounded-xl bg-white/10 border border-white/20 p-3 outline-none" placeholder="Password"/>
      </div>
    </div>
    <div class="mt-4 flex gap-3">
      <button id="memberEnter" class="btn btn-primary">Enter</button>
    </div>
  </div>

  <div id="memberPanel" class="hidden mt-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold">This Week's Tasks — <span id="memberWeek"></span></h3>
      <div class="text-sm text-white/70">Logged in as <span id="memberWho" class="font-semibold"></span></div>
    </div>
    <div id="memberTasks"></div>
    <div class="mt-6 flex items-center gap-3">
      <button id="memberSubmit" class="btn btn-primary">Submit</button>
      <span id="memberMsg" class="text-sm"></span>
    </div>
  </div>
</section>

<!-- CHAT (private member <-> admin) -->
<section id="chat" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Chat</h2>
  <div id="chatMemberGate" class="glass rounded-2xl p-6">
    <p class="text-white/80">Log in as a member in the Members Area to start a private chat with the admins.</p>
  </div>
  <div id="chatMember" class="hidden glass rounded-2xl p-6">
    <div class="text-sm text-white/70 mb-3">Private chat with Admins — visible only to <span id="chatMemberName" class="font-semibold"></span> and Admins.</div>
    <div id="memberChatBox" class="space-y-3 max-h-72 overflow-auto pr-1 bg-white/5 rounded-xl p-3"></div>
    <div class="mt-3 flex gap-2">
      <input id="memberChatInput" class="flex-1 rounded-xl bg-white/10 border border-white/20 p-3 outline-none" placeholder="Ask a question..."/>
      <button id="memberChatSend" class="btn btn-primary">Send</button>
    </div>
  </div>

  <div id="chatAdmin" class="hidden glass rounded-2xl p-6 admin-only">
    <h3 class="text-xl font-semibold mb-3">Member Questions (Private Threads)</h3>
    <div id="chatThreads" class="grid md:grid-cols-2 gap-4"></div>
  </div>
</section>

<!-- ADMIN -->
<section id="admin" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Admin Area</h2>
  <div id="adminGate" class="glass rounded-2xl p-6">
    <div class="grid md:grid-cols-2 gap-6 items-end">
      <div>
        <label class="block text-sm mb-1">Admin Name</label>
        <input id="adminName" class="w-full rounded-xl bg-white/10 border border-white/20 p-3 outline-none" placeholder="Admin name"/>
      </div>
      <div>
        <label class="block text-sm mb-1">Admin Password</label>
        <input id="adminPass" type="password" class="w-full rounded-xl bg-white/10 border border-white/20 p-3 outline-none" placeholder="Password"/>
      </div>
    </div>
    <div class="mt-4 flex gap-3">
      <button id="adminEnter" class="btn btn-rose">Enter Admin</button>
    </div>
  </div>

  <div id="adminPanel" class="hidden mt-6 space-y-8">
    <div class="glass rounded-2xl p-6 admin-only">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Tasks by Member — Week <span id="adminWeek"></span></h3>
        <button id="rollWeek" class="btn btn-ghost" title="Run weekly check (removes members failing 3 weeks)">Weekly Check</button>
      </div>
      <div class="grid md:grid-cols-3 gap-3">
        <input id="newMember" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Member name"/>
        <input id="newTask" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Task description"/>
        <button id="addTask" class="btn btn-primary">Add Task</button>
      </div>
      <div class="mt-4 grid md:grid-cols-2 gap-6" id="adminMembers"></div>
    </div>

    <div class="glass rounded-2xl p-6 admin-only">
      <h3 class="text-xl font-semibold mb-3">Site Settings</h3>
      <div class="flex flex-wrap items-center gap-4">
        <label class="text-sm">Upload Logo <input id="logoUploader" type="file" accept="image/*" class="ml-2"/></label>
        <button id="exportData" class="btn btn-ghost">Export Data</button>
        <input id="importFile" type="file" accept="application/json" class="hidden"/>
        <button id="importDataBtn" class="btn btn-ghost">Import Data</button>
        <button id="resetAll" class="btn btn-rose">Reset Everything</button>
      </div>
      <div class="mt-4 grid sm:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">Instagram URL</label>
          <input id="smIg" class="w-full rounded-xl bg-white/10 border border-white/20 p-3" placeholder="https://instagram.com/..."/>
        </div>
        <div>
          <label class="block text-sm mb-1">Facebook URL</label>
          <input id="smFb" class="w-full rounded-xl bg-white/10 border border-white/20 p-3" placeholder="https://facebook.com/..."/>
        </div>
        <div>
          <label class="block text-sm mb-1">YouTube URL</label>
          <input id="smYt" class="w-full rounded-xl bg-white/10 border border-white/20 p-3" placeholder="https://youtube.com/..."/>
        </div>
        <div>
          <label class="block text-sm mb-1">TikTok/Other URL</label>
          <input id="smTk" class="w-full rounded-xl bg-white/10 border border-white/20 p-3" placeholder="https://tiktok.com/@..."/>
        </div>
        <button id="saveSocial" class="btn btn-primary w-max">Save Social Links</button>
      </div>
    </div>
  </div>
</section>

<!-- CALENDAR -->
<section id="calendar" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Projects & Calendar</h2>
  <div class="glass rounded-2xl p-6">
    <div class="grid md:grid-cols-[2fr,3fr] gap-6">
      <div class="admin-only">
        <label class="block text-sm mb-1">Add Event</label>
        <div class="grid gap-2">
          <input id="calTitle" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Event title"/>
          <input id="calDate" type="date" class="rounded-xl bg-white/10 border border-white/20 p-3"/>
          <input id="calDesc" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Description (optional)"/>
          <button id="addEvent" class="btn btn-primary w-max">Add</button>
        </div>
      </div>
      <div>
        <div id="calendarList" class="space-y-2 max-h-80 overflow-auto"></div>
      </div>
    </div>
  </div>
</section>

<!-- BEST INTERACTOR (Quarterly) -->
<section id="best" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Best Interactor — Quarterly</h2>
  <div class="glass rounded-2xl p-6">
    <div class="grid md:grid-cols-2 gap-6">
      <div class="admin-only">
        <h3 class="font-semibold mb-2">Admin Controls</h3>
        <div class="grid md:grid-cols-3 gap-3 items-end">
          <div>
            <label class="block text-sm mb-1">Year</label>
            <input id="biYear" type="number" min="2023" class="w-full rounded-xl bg-white/10 border border-white/20 p-3" placeholder="2025"/>
          </div>
          <div>
            <label class="block text-sm mb-1">Quarter</label>
            <select id="biQuarter" class="w-full rounded-xl bg-white/10 border border-white/20 p-3">
              <option value="Q1">Q1 (Jan–Mar)</option>
              <option value="Q2">Q2 (Apr–Jun)</option>
              <option value="Q3">Q3 (Jul–Sep)</option>
              <option value="Q4">Q4 (Oct–Dec)</option>
            </select>
          </div>
          <button id="biSetActive" class="btn btn-ghost">Set Active Quarter</button>
        </div>
        <div class="border-t border-white/10 mt-4 pt-4">
          <h4 class="font-semibold mb-2">Add Nominee (max 3 per month)</h4>
          <div class="grid md:grid-cols-2 gap-2">
            <input id="nomName" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Interactor name"/>
            <input id="nomClass" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Class/Role (optional)"/>
          </div>
          <div class="mt-2 flex flex-wrap items-center gap-3">
            <label class="text-sm">Photo <input id="nomPhoto" type="file" accept="image/*" class="ml-2"/></label>
            <button id="addNominee" class="btn btn-primary">Add Nominee</button>
            <button id="clearNominees" class="btn btn-ghost">Clear All Nominees (active quarter)</button>
          </div>
        </div>
        <div class="border-t border-white/10 mt-4 pt-4">
          <h4 class="font-semibold mb-2">Set Winner (active quarter)</h4>
          <select id="winnerSelect" class="rounded-xl bg-white/10 border border-white/20 p-3 w-full"></select>
          <button id="setWinner" class="btn btn-rose mt-2">Set Winner</button>
        </div>
      </div>
      <div>
        <h3 id="bestTitle" class="font-semibold mb-2">Public View</h3>
        <div id="bestPublic" class="space-y-4"></div>
      </div>
    </div>
  </div>
</section>

<!-- FAMILY PHOTOS (with Albums) -->
<section id="photos" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Family Photos</h2>
  <div class="glass rounded-2xl p-6">
    <div class="admin-only mb-4 grid md:grid-cols-[2fr,3fr] gap-4">
      <div class="space-y-2">
        <label class="block text-sm">Create Album</label>
        <div class="flex gap-2">
          <input id="albumName" class="flex-1 rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Album name (e.g., Installation 2025)"/>
          <button id="addAlbum" class="btn btn-primary">Add</button>
        </div>
      </div>
      <div class="space-y-2">
        <label class="block text-sm">Manage Selected Album</label>
        <div class="flex flex-wrap gap-2">
          <input id="renameAlbumInput" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="New album name"/>
          <button id="renameAlbum" class="btn btn-ghost">Rename</button>
          <button id="deleteAlbum" class="btn btn-rose">Delete Album</button>
          <label class="text-sm">Upload Photos
            <input id="galUpload" type="file" accept="image/*" multiple class="ml-2"/>
          </label>
          <button id="clearAlbum" class="btn btn-ghost">Clear Photos</button>
        </div>
      </div>
    </div>
    <div class="mb-3 flex items-center gap-3">
      <label class="text-sm">Album</label>
      <select id="albumSelect" class="rounded-xl bg-white/10 border border-white/20 p-2"></select>
    </div>
    <div id="gallery" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
  </div>
</section>

<!-- COMPLETED PROJECTS (admin controls + public list) -->
<section id="projects" class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-4">Completed Projects</h2>
  <div class="glass rounded-2xl p-6">
    <div class="admin-only mb-4">
      <div class="grid md:grid-cols-3 gap-3">
        <input id="projName" class="rounded-xl bg-white/10 border border-white/20 p-3" placeholder="Project name"/>
        <input id="projDate" type="date" class="rounded-xl bg-white/10 border border-white/20 p-3"/>
        <label class="text-sm flex items-center gap-2">Logo
          <input id="projLogo" type="file" accept="image/*"/>
        </label>
      </div>
      <button id="addProject" class="btn btn-primary mt-3">Add Project</button>
    </div>
    <div id="projectsList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
  </div>
</section>

<!-- ABOUT (last section) -->
<section id="about" class="max-w-7xl mx-auto px-4 py-10">
  <div class="glass rounded-2xl p-6 space-y-4">
    <p class="text-lg font-bold">
      Psalm 20:7 — Some trust in chariots and some in horses, but we trust in the Lord our God.
    </p>
    <p class="text-white/80 leading-relaxed">
      Founded in 2023, the Interact Club has faced its share of challenges—setbacks that slowed our momentum,
      moments when progress halted, and seasons when some even gave up.
      Yet, by God’s grace and with the steadfast support of our school Rector, we rise again with renewed purpose.
      We’re bringing the family back together—bigger, better, and more united—to serve, to grow, and to succeed this time.
      And while it may sound like a cliché, our journey will prove a simple truth: The power in having faith and never losing hope.
      <p class="text-white/80 leading-relaxed">
  “Our mission is to drive genuine change in this country, both in what we do and how we do it,
  while building up our Interact family and helping growth flourish around us as we grow within.”
</p>

    </p>
  </div>
</section>

<!-- FOOTER -->
<footer class="mt-8 border-t border-white/10">
  <div class="max-w-7xl mx-auto px-4 py-6 flex flex-col md:flex-row items-center justify-between gap-3 text-white/80">
    <div>Website created on <strong>10/04/2025</strong></div>
    <div id="socialLinks" class="flex items-center gap-4"></div>
  </div>
</footer>

<!-- TOAST -->
<dialog id="toast" class="rounded-xl p-0 bg-white/95 text-slate-900 min-w-[280px]">
  <div class="p-4 text-center space-y-2">
    <div id="toastMsg" class="font-semibold"></div>
    <button onclick="document.getElementById('toast').close()" class="btn">Close</button>
  </div>
</dialog>

<script>
/* ---------- helpers & storage ---------- */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const store={get(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch(e){return d}},set(k,v){localStorage.setItem(k,JSON.stringify(v))}};
function isoWeek(d=new Date()){const t=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));const n=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-n);const y=new Date(Date.UTC(t.getUTCFullYear(),0,1));const w=Math.ceil((((t-y)/86400000)+1)/7);return {year:t.getUTCFullYear(),week:w}}
function weekKey(o){return `${o.year}-W${String(o.week).padStart(2,'0')}`}
function weekOfMonth(dt=new Date()){const d=new Date(dt);const f=new Date(d.getFullYear(),d.getMonth(),1).getDay();return Math.ceil((d.getDate()+f)/7)}
function showToast(msg){$('#toastMsg').textContent=msg;$('#toast').showModal()}

/* ---------- passwords (not shown in UI) ---------- */
const MEMBER_PASSWORD='02';
const ADMIN_PASSWORD='Admin123';

/* ---------- database ---------- */
const db = store.get('icstic', {
  logoDataUrl:null,
  members:{},          // {name:{removed,fails,lastChecked}}
  tasks:{},            // {weekKey:{member:[{id,text,done}]}}
  chat:[],             // [{id, member, role:'member'|'admin', text, ts}]
  calendar:[],         // [{id,title,date,desc}]
  // Best Interactor (Quarterly)
  bi:{ activeKey:null, quarters:{} }, // { quarters: { "2025-Q1": {winnerId:null, nominees:[{id,name,klass,photo,month:"YYYY-MM"}] } } }
  // Gallery albums
  albums:{},           // {albumName:[dataUrl,...]}
  currentAlbum:null,
  // Completed projects
  projects:[],         // [{id,name,date,logo}]
  // Social links
  social:{ ig:"", fb:"", yt:"", tk:"" }
});
const save=()=>store.set('icstic',db);

/* ---------- branding (repo-hosted logo for everyone) ---------- */
const SITE_LOGO_URL = "/logo.png"; // change path if needed
function defaultLogo(){
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
       <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
         <stop stop-color="#0ea5e9"/><stop offset="1" stop-color="#22c55e"/>
       </linearGradient></defs>
       <rect width="200" height="200" rx="28" fill="url(#g)"/>
       <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle"
             font-family="Verdana" font-size="72" fill="white">I</text>
     </svg>`
  );
}
function setLogo(){ const src = SITE_LOGO_URL || defaultLogo(); $('#clubLogo').src=src; $('#heroLogo').src=src; }
setLogo();

/* ---------- nav ---------- */
$('#openNav').onclick=()=>$('#mobileNav').classList.toggle('hidden');

/* ---------- admin visibility ---------- */
function hideAdminOnly(){$$('.admin-only').forEach(e=>e.classList.add('hidden'))}
function showAdminOnly(){$$('.admin-only').forEach(e=>e.classList.remove('hidden'))}
hideAdminOnly();

/* ---------- member area ---------- */
let currentMember=null;
function ensureMember(n){if(!db.members[n]) db.members[n]={removed:false,fails:0,lastChecked:null}}
function renderMemberTasks(n){
  const wk=weekKey(isoWeek());$('#memberWeek').textContent=wk;
  const list=(db.tasks[wk]?.[n]??[]);const root=$('#memberTasks');root.innerHTML='';
  if(list.length===0){root.innerHTML='<div class="glass rounded-2xl p-4">No tasks yet.</div>';return}
  list.forEach(t=>{
    const c=document.createElement('div');c.className='glass rounded-2xl p-4 flex items-start gap-3';
    c.innerHTML=`<input type="checkbox" ${t.done?'checked':''} class="mt-1 h-5 w-5 shrink-0"/> <div><div class="font-medium">${t.text}</div><div class="text-xs text-white/60">Task ID: ${t.id}</div></div>`;
    c.querySelector('input').onchange=e=>{t.done=e.target.checked;save()};
    root.appendChild(c);
  })
}
function evaluateMember(n){
  const k=weekKey(isoWeek());const tasks=db.tasks[k]?.[n]??[];
  const all=tasks.length>0&&tasks.every(t=>t.done);
  const m=$('#memberMsg');
  if(all){ m.textContent='GREAT JOB , MY FRIEND'; showToast('GREAT JOB , MY FRIEND') }
  else   { m.textContent='HOPE YOU DO BETTER NEXT TIME , FRIEND'; showToast('HOPE YOU DO BETTER NEXT TIME , FRIEND') }
  const mm=db.members[n];
  if(!all){ mm.fails=(mm.fails||0)+1 } else { mm.fails=0 }
  if(mm.fails>=3){ mm.removed=true; showToast(`${n} removed after 3 failed weeks`) }
  mm.lastChecked=k; save();
}
$('#memberEnter').onclick=()=>{
  const n=$('#memberName').value.trim(); const p=$('#memberPass').value.trim();
  if(!n) return showToast('Enter your name'); if(p!==MEMBER_PASSWORD) return showToast('Wrong member password');
  ensureMember(n); save(); currentMember=n;
  $('#memberWho').textContent=n; $('#memberGate').classList.add('hidden'); $('#memberPanel').classList.remove('hidden');
  renderMemberTasks(n); renderMemberChat();
  $('#chatMemberGate').classList.add('hidden'); $('#chatMember').classList.remove('hidden'); $('#chatMemberName').textContent=n;
}
$('#memberSubmit').onclick=()=>evaluateMember(currentMember);

/* ---------- private chat ---------- */
function renderMemberChat(){
  const box=$('#memberChatBox'); if(!box) return; box.innerHTML='';
  db.chat.filter(m=>m.member===currentMember).forEach(m=>{
    const mine=m.role==='member';
    const row=document.createElement('div'); row.className='flex items-start gap-2';
    row.innerHTML=`<div class="text-xs mt-1 ${mine?'text-white/60':'text-emerald-300'}">${mine?'You':'Admin'}</div><div class="bg-white/10 rounded-xl px-3 py-2 flex-1">${m.text}</div>`;
    box.appendChild(row);
  });
  box.scrollTop=box.scrollHeight;
}
$('#memberChatSend').onclick=()=>{
  if(!currentMember) return showToast('Login as member first');
  const t=$('#memberChatInput').value.trim(); if(!t) return;
  db.chat.push({id:crypto.randomUUID(),member:currentMember,role:'member',text:t,ts:Date.now()});
  $('#memberChatInput').value=''; save(); renderMemberChat(); renderAdminThreads();
}
function renderAdminThreads(){
  const root=$('#chatThreads'); if(!root) return; root.innerHTML='';
  const byMember={}; db.chat.forEach(m=>{(byMember[m.member] ||= []).push(m)});
  Object.keys(byMember).sort().forEach(name=>{
    const msgs=byMember[name];
    const card=document.createElement('div'); card.className='glass rounded-2xl p-3';
    card.innerHTML=`<div class="flex items-center justify-between mb-2"><div class="font-semibold">${name}</div><div class="text-xs text-white/60">${msgs.length} msg</div></div><div class="space-y-2 max-h-52 overflow-auto pr-1" data-box></div><div class="mt-2 flex gap-2"><input class="flex-1 rounded-xl bg-white/10 border border-white/20 p-2" placeholder="Reply to ${name}..."/><button class="btn btn-primary">Reply</button></div>`;
    const box=card.querySelector('[data-box]');
    msgs.forEach(m=>{
      const r=document.createElement('div'); r.className='flex gap-2 items-start';
      r.innerHTML=`<div class="text-xs mt-1 ${m.role==='admin'?'text-emerald-300':'text-white/60'}">${m.role==='admin'?'Admin':name}</div><div class="bg-white/10 rounded-xl px-3 py-2 flex-1">${m.text}</div>`;
      box.appendChild(r);
    });
    card.querySelector('button').onclick=()=>{
      const t=card.querySelector('input').value.trim(); if(!t) return;
      db.chat.push({id:crypto.randomUUID(),member:name,role:'admin',text:t,ts:Date.now()});
      save(); renderAdminThreads(); if(currentMember===name) renderMemberChat();
    };
    root.appendChild(card);
  });
}

/* ---------- admin login & task admin ---------- */
let currentAdmin=null;
function renderAdmin(){
  $('#adminWeek').textContent=weekKey(isoWeek());
  const panel=$('#adminMembers'); panel.innerHTML='';
  const names=Object.keys(db.members).filter(n=>!db.members[n].removed).sort();
  const wk=weekKey(isoWeek());
  names.forEach(n=>{
    const tasks=(db.tasks[wk]?.[n]??[]);
    const card=document.createElement('div'); card.className='glass rounded-2xl p-4';
    card.innerHTML=`<div class="flex items-center justify-between mb-2"><div class="font-semibold">${n}</div><div class="text-xs text-white/60">fails: ${db.members[n].fails||0}</div></div><div class="space-y-2" data-list></div><div class="mt-2 flex gap-2"><button class="btn btn-ghost" data-add>Add Task</button><button class="btn btn-ghost" data-clear>Clear</button><button class="btn btn-rose" data-remove>Remove Member</button></div>`;
    const list=card.querySelector('[data-list]');
    tasks.forEach(t=>{
      const row=document.createElement('div'); row.className='flex items-center gap-2';
      row.innerHTML=`<input type="checkbox" ${t.done?'checked':''}/> <input class="flex-1 rounded-xl bg-white/10 border border-white/20 p-2" value="${t.text}"/> <button class="btn btn-ghost" data-del>✖</button>`;
      row.querySelector('input[type="checkbox"]').onchange=e=>{t.done=e.target.checked;save()};
      row.querySelector('input:not([type])').onchange=e=>{t.text=e.target.value;save()};
      row.querySelector('[data-del]').onclick=()=>{const arr=db.tasks[wk][n]; db.tasks[wk][n]=arr.filter(x=>x.id!==t.id); save(); renderAdmin()};
      list.appendChild(row);
    });
    card.querySelector('[data-add]').onclick=()=>{addTaskTo(n,$('#newTask').value.trim()||'New Task')};
    card.querySelector('[data-clear]').onclick=()=>{ if(db.tasks[wk]) db.tasks[wk][n]=[]; save(); renderAdmin() };
    card.querySelector('[data-remove]').onclick=()=>{ db.members[n].removed=true; save(); renderAdmin() };
    panel.appendChild(card);
  });
}
function addTaskTo(n,txt){
  if(!txt) return showToast('Enter a task');
  const wk=weekKey(isoWeek()); db.tasks[wk] ||= {}; db.tasks[wk][n] ||= [];
  db.tasks[wk][n].push({id:crypto.randomUUID(),text:txt,done:false});
  save(); renderAdmin(); if(currentMember===n) renderMemberTasks(n);
}
$('#addTask').onclick=()=>{const n=$('#newMember').value.trim(); if(!n) return showToast('Enter member name'); ensureMember(n); addTaskTo(n,$('#newTask').value.trim()); $('#newTask').value=''; save()}
$('#adminEnter').onclick=()=>{
  const n=$('#adminName').value.trim(); const p=$('#adminPass').value.trim();
  if(!n) return showToast('Enter admin name'); if(p!==ADMIN_PASSWORD) return showToast('Wrong admin password');
  currentAdmin=n; $('#adminGate').classList.add('hidden'); $('#adminPanel').classList.remove('hidden'); showAdminOnly();
  renderAdmin(); renderAdminThreads(); $('#chatAdmin').classList.remove('hidden'); renderCalendar(); renderGallery(); renderProjects(); renderBest(); hydrateSocialInputs();
}
$('#rollWeek').onclick=()=>{
  const wk=weekKey(isoWeek());
  for(const n of Object.keys(db.members)){
    const m=db.members[n]; if(m.removed) continue;
    const tasks=db.tasks[wk]?.[n]??[];
    const all=tasks.length>0&&tasks.every(t=>t.done);
    if(!all){ m.fails=(m.fails||0)+1 } else { m.fails=0 }
    if(m.fails>=3){ m.removed=true }
  }
  save(); showToast('Weekly check complete.');
};

/* ---------- calendar ---------- */
function renderCalendar(){
  const list=$('#calendarList'); if(!list) return; list.innerHTML='';
  db.calendar.sort((a,b)=>a.date.localeCompare(b.date));
  db.calendar.forEach(e=>{
    const row=document.createElement('div'); row.className='glass rounded-xl p-3 flex items-start justify-between gap-3';
    row.innerHTML=`<div><div class="font-semibold">${e.title}</div><div class="text-xs text-white/60">${e.date}</div><div class="text-sm">${e.desc||''}</div></div>${currentAdmin?'<button class="btn btn-ghost">✖</button>':''}`;
    if(currentAdmin) row.querySelector('button').onclick=()=>{ db.calendar=db.calendar.filter(x=>x.id!==e.id); save(); renderCalendar() };
    list.appendChild(row);
  });
}
$('#addEvent').onclick=()=>{
  const t=$('#calTitle').value.trim(); const d=$('#calDate').value; const c=$('#calDesc').value.trim();
  if(!t||!d) return showToast('Add title and date');
  db.calendar.push({id:crypto.randomUUID(),title:t,date:d,desc:c}); save(); renderCalendar();
  $('#calTitle').value=''; $('#calDesc').value='';
};
renderCalendar();

/* ---------- Best Interactor (Quarterly) ---------- */
const QUARTER_MONTHS={Q1:[1,2,3],Q2:[4,5,6],Q3:[7,8,9],Q4:[10,11,12]};
function quarterKey(year,q){return `${year}-${q}`;}
function monthStr(d=new Date()){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;}
function monthInQuarter(year,q,m){return QUARTER_MONTHS[q].includes(m);}
function ensureQuarter(key){ db.bi.quarters[key] ||= {winnerId:null, nominees:[]}; save(); }
function setActiveQuarter(year,q){ const k=quarterKey(year,q); db.bi.activeKey=k; ensureQuarter(k); save(); renderBest(); }
function renderBest(){
  const k=db.bi.activeKey, title=$('#bestTitle'), pub=$('#bestPublic'), sel=$('#winnerSelect'); if(!title||!pub) return;
  const now=new Date(); const defaultYear=now.getFullYear(); const m=now.getMonth()+1; const defaultQ=m<=3?'Q1':m<=6?'Q2':m<=9?'Q3':'Q4';
  const yearInput=$('#biYear'), qSel=$('#biQuarter'); if(yearInput&&!yearInput.value) yearInput.value=defaultYear; if(qSel&&!qSel.value) qSel.value=defaultQ;
  if(!db.bi.activeKey){ setActiveQuarter(Number(yearInput?.value||defaultYear), qSel?.value||defaultQ); return; }
  const box=db.bi.quarters[k]||{winnerId:null, nominees:[]}; const [yy,qq]=k.split('-'); title.textContent=`Public View — ${qq} ${yy}`; pub.innerHTML='';
  if(box.winnerId){ const w=box.nominees.find(n=>n.id===box.winnerId); if(w){ const card=document.createElement('div'); card.className='glass rounded-2xl p-4 text-center';
    card.innerHTML=`<div class="text-sm text-white/60 mb-1">Best Interactor — ${qq} ${yy}</div><img src="${w.photo||defaultLogo()}" class="h-40 w-40 object-cover rounded-2xl mx-auto ring-2 ring-white/10"/><div class="mt-2 text-xl font-bold">${w.name}</div><div class="text-sm text-white/70">${w.klass||''}</div>`; pub.appendChild(card);
    if(sel){ sel.innerHTML=`<option value="${w.id}">${w.name}</option>`; } return; }
  }
  const [Y,Q]=[Number(yy),qq]; const months=QUARTER_MONTHS[Q]; const perMonth={}; months.forEach(mm=>perMonth[mm]=[]);
  box.nominees.forEach(n=>{ const mm=Number(n.month.split('-')[1]); if(months.includes(mm)) perMonth[mm].push(n); });
  if(sel){ sel.innerHTML='<option value="">-- choose winner --</option>'; box.nominees.forEach(n=>{ const o=document.createElement('option'); o.value=n.id; o.textContent=n.name; sel.appendChild(o); }); }
  months.forEach(mm=>{
    const group=document.createElement('div'); const monthName=new Date(Y,mm-1,1).toLocaleString(undefined,{month:'long'});
    group.innerHTML=`<div class="font-semibold mb-2">${monthName} ${Y}</div>`; const wrap=document.createElement('div'); wrap.className='grid grid-cols-2 md:grid-cols-3 gap-3';
    const list=perMonth[mm];
    if(list.length===0){ const empty=document.createElement('div'); empty.className='text-white/70'; empty.textContent='No nominees yet.'; group.appendChild(empty); }
    else { list.slice(0,3).forEach(n=>{ const card=document.createElement('div'); card.className='glass rounded-2xl p-3 text-center';
      card.innerHTML=`<img src="${n.photo||defaultLogo()}" class="h-32 w-32 object-cover rounded-2xl mx-auto ring-2 ring-white/10"/><div class="mt-2 font-semibold">${n.name}</div><div class="text-xs text-white/60">${n.klass||''}</div>`; wrap.appendChild(card); });
      group.appendChild(wrap);
    }
    pub.appendChild(group);
  });
}
$('#biSetActive')?.addEventListener('click',()=>{ const y=Number($('#biYear').value||new Date().getFullYear()); const q=$('#biQuarter').value||'Q1'; setActiveQuarter(y,q); });
$('#addNominee')?.addEventListener('click',()=>{
  const k=db.bi.activeKey; if(!k) return showToast('Set the active quarter first.'); const box=db.bi.quarters[k];
  const name=$('#nomName').value.trim(); if(!name) return showToast('Enter a name'); const klass=$('#nomClass').value.trim(); const file=$('#nomPhoto').files[0];
  const now=new Date(); const thisMonth=monthStr(now); const mm=now.getMonth()+1; const [yy,qq]=k.split('-'); if(!monthInQuarter(Number(yy),qq,mm)) return showToast('This month is not in the active quarter.');
  const thisMonthNominees=box.nominees.filter(n=>n.month===thisMonth); if(thisMonthNominees.length>=3) return showToast('Already have 3 nominees for this month.');
  const add=(photo)=>{ box.nominees.push({id:crypto.randomUUID(),name,klass,photo,month:thisMonth}); save(); $('#nomName').value=''; $('#nomClass').value=''; $('#nomPhoto').value=''; renderBest(); };
  if(file){ const r=new FileReader(); r.onload=()=>add(r.result); r.readAsDataURL(file); } else { add(null); }
});
$('#clearNominees')?.addEventListener('click',()=>{ const k=db.bi.activeKey; if(!k) return; if(!confirm('Clear all nominees for the active quarter?')) return; db.bi.quarters[k].nominees=[]; db.bi.quarters[k].winnerId=null; save(); renderBest(); });
$('#setWinner')?.addEventListener('click',()=>{ const k=db.bi.activeKey; if(!k) return; const id=$('#winnerSelect').value; if(!id) return showToast('Choose a winner'); db.bi.quarters[k].winnerId=id; save(); renderBest(); showToast('Winner set for the quarter'); });
renderBest();

/* ---------- albums & gallery ---------- */
function ensureAlbum(){ if(!db.currentAlbum){ const first=Object.keys(db.albums)[0]; db.currentAlbum=first||'General'; db.albums[db.currentAlbum] ||= [] } }
function renderAlbumPicker(){ ensureAlbum(); const sel=$('#albumSelect'); sel.innerHTML=''; Object.keys(db.albums).sort().forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; if(n===db.currentAlbum) o.selected=true; sel.appendChild(o) }); if(Object.keys(db.albums).length===0){ db.albums['General']=[]; db.currentAlbum='General' } save(); }
function renderGallery(){ ensureAlbum(); const g=$('#gallery'); g.innerHTML=''; (db.albums[db.currentAlbum]||[]).forEach((src,i)=>{ const fig=document.createElement('figure'); fig.className='relative'; fig.innerHTML=`<img src="${src}" class="w-full h-32 object-cover rounded-xl ring-2 ring-white/10"/>${currentAdmin?'<button class="btn btn-ghost absolute top-1 right-1">✖</button>':''}`; if(currentAdmin) fig.querySelector('button').onclick=()=>{ db.albums[db.currentAlbum].splice(i,1); save(); renderGallery() }; g.appendChild(fig) }) }
$('#albumSelect').onchange=e=>{ db.currentAlbum=e.target.value; save(); renderGallery(); }
$('#addAlbum').onclick=()=>{ const n=$('#albumName').value.trim(); if(!n) return showToast('Album name?'); if(db.albums[n]) return showToast('Album exists'); db.albums[n]=[]; db.currentAlbum=n; $('#albumName').value=''; save(); renderAlbumPicker(); renderGallery(); }
$('#renameAlbum').onclick=()=>{ const n=$('#renameAlbumInput').value.trim(); if(!n) return; const old=db.currentAlbum; if(!db.albums[old]) return; db.albums[n]=db.albums[old]; delete db.albums[old]; db.currentAlbum=n; $('#renameAlbumInput').value=''; save(); renderAlbumPicker(); renderGallery(); }
$('#deleteAlbum').onclick=()=>{ const a=db.currentAlbum; if(!a) return; delete db.albums[a]; db.currentAlbum=null; ensureAlbum(); save(); renderAlbumPicker(); renderGallery(); }
$('#clearAlbum').onclick=()=>{ db.albums[db.currentAlbum]=[]; save(); renderGallery(); }
$('#galUpload').onchange=async e=>{ const files=Array.from(e.target.files); if(files.length===0) return; for(const f of files){ await new Promise(res=>{ const r=new FileReader(); r.onload=()=>{ db.albums[db.currentAlbum].push(r.result); res(); }; r.readAsDataURL(f); }) } save(); renderGallery(); }
renderAlbumPicker(); renderGallery();

/* ---------- completed projects ---------- */
function renderProjects(){
  const list=$('#projectsList'); if(!list) return; list.innerHTML='';
  db.projects.sort((a,b)=>a.date.localeCompare(b.date)).reverse();
  db.projects.forEach(p=>{
    const card=document.createElement('div'); card.className='glass rounded-2xl p-4 flex items-start gap-3';
    card.innerHTML=`
      <img src="${p.logo||defaultLogo()}" class="h-16 w-16 object-cover rounded-xl ring-2 ring-white/10"/>
      <div class="flex-1">
        <div class="font-semibold">${p.name}</div>
        <div class="text-xs text-white/60">${p.date||''}</div>
      </div>
      ${currentAdmin?'<button class="btn btn-ghost">✖</button>':''}
    `;
    if(currentAdmin) card.querySelector('button').onclick=()=>{ db.projects=db.projects.filter(x=>x.id!==p.id); save(); renderProjects(); };
    list.appendChild(card);
  });
}
$('#addProject').onclick=()=>{
  const name=$('#projName').value.trim(); const date=$('#projDate').value; const f=$('#projLogo').files[0];
  if(!name||!date) return showToast('Enter project name and date');
  const add=(logo)=>{ db.projects.push({id:crypto.randomUUID(),name,date,logo}); save(); $('#projName').value=''; $('#projDate').value=''; $('#projLogo').value=''; renderProjects(); };
  if(f){ const r=new FileReader(); r.onload=()=>add(r.result); r.readAsDataURL(f); } else { add(null); }
};
renderProjects();

/* ---------- social links ---------- */
function hydrateSocialInputs(){ $('#smIg').value=db.social.ig||''; $('#smFb').value=db.social.fb||''; $('#smYt').value=db.social.yt||''; $('#smTk').value=db.social.tk||''; }
function renderSocialLinks(){
  const root=$('#socialLinks'); if(!root) return; root.innerHTML='';
  const links=[ ['Instagram',db.social.ig,'instagram'], ['Facebook',db.social.fb,'facebook'], ['YouTube',db.social.yt,'youtube'], ['More',db.social.tk,'link'] ];
  links.forEach(([label,url,icon])=>{
    if(url){ const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener'; a.className='inline-flex items-center gap-2 hover:text-emerald-300';
      a.innerHTML=`<i data-lucide="${icon}" class="w-5 h-5"></i><span class="hidden sm:inline">${label}</span>`; root.appendChild(a); }
  });
  if(window.lucide) lucide.createIcons();
}
$('#saveSocial').onclick=()=>{ db.social.ig=$('#smIg').value.trim(); db.social.fb=$('#smFb').value.trim(); db.social.yt=$('#smYt').value.trim(); db.social.tk=$('#smTk').value.trim(); save(); renderSocialLinks(); showToast('Social links saved'); };
renderSocialLinks();

/* ---------- site settings (logo upload affects only your device; repo logo stays global) ---------- */
$('#logoUploader').onchange=async e=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ db.logoDataUrl=r.result; save(); showToast('Logo uploaded locally (repo logo is global)'); }; r.readAsDataURL(f); };
$('#exportData').onclick=()=>{ const blob=new Blob([JSON.stringify(db,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='icstic-data.json'; a.click(); };
$('#importDataBtn').onclick=()=>$('#importFile').click();
$('#importFile').onchange=async e=>{ const f=e.target.files[0]; if(!f) return; const text=await f.text(); try{ const json=JSON.parse(text); Object.assign(db,json); save(); location.reload(); } catch{ showToast('Invalid file'); } };
$('#resetAll').onclick=()=>{ if(confirm('Clear all data on this device?')){ localStorage.removeItem('icstic'); location.reload(); } };

/* ---------- init ---------- */
window.addEventListener('load',()=>{ if(window.lucide) lucide.createIcons(); $('#memberWeek').textContent=weekKey(isoWeek()); renderCalendar(); renderProjects(); renderBest(); renderSocialLinks(); });
</script>
</body>
</html>
